{%- set p_k = (k | default(100)) -%}
{%- set p_candidates = (candidates | default(1000)) -%}
{%- set p_data_size = (data_size | default([10, 100, 500, 1000, 5000, 10000, 50000, 100000, 500000, 1000000])) -%}
{
  "name": "index-and-search",
  "description": "",
  "default": true,
  "schedule": [
    {%- for i in range(p_data_size|length) -%}
    {%- if i != 0 -%},{%- endif -%}
    {
      "operation": "delete-index-{{p_data_size[i]}}"
    },
    {
      "operation": "create-index-{{p_data_size[i]}}"
    },
    {
      "operation": "check-cluster-health-{{p_data_size[i]}}"
    },
    {
      "operation": "index-docs-{{p_data_size[i]}}",
      "warmup-time-period": {{ bulk_warmup | default(40) | int }},
      "clients": {{bulk_indexing_clients | default(1)}}
    },
    {
      "operation": "knn-search-{{p_k}}-{{p_candidates}}-{{p_data_size[i]}}",
      "warmup-iterations": 100,
      "iterations": {{ standalone_search_iterations | default(10000) | int }}
    },
    {
      "operation": "force-merge-{{p_data_size[i]}}"
    },
    {
      "operation": "refresh-after-force-merge-{{p_data_size[i]}}"
    },
    {
      "operation": "wait-until-merges-finish-{{p_data_size[i]}}",
      "retry-until-success": true,
      "include-in-reporting": false
    },
    {
      "operation": "knn-search-{{p_k}}-{{p_candidates}}-after-merge-{{p_data_size[i]}}",
      "warmup-iterations": 100,
      "iterations": {{ standalone_search_iterations | default(10000) | int }}
    }
    {%- endfor -%}
  ]
}